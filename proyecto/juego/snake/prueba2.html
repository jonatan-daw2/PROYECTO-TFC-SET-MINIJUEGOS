<!DOCTYPE html>
<html>
<head>
  <title>Serpiente</title>
  <style>
    canvas {
      border: 1px solid black;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>

  <script>
    // Dimensiones de la pantalla
    var canvasWidth = 800;
    var canvasHeight = 600;

    // Tamaño de los segmentos de la serpiente
    var segmentSize = 20;

    // Velocidad de la serpiente (número de actualizaciones por segundo)
    var speed = 10;

    // Obtener el elemento del lienzo (canvas)
    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');

    // Imágenes de la cabeza, la cola y el cuerpo de la serpiente
    var headImages = {
      right: new Image(),
      left: new Image(),
      up: new Image(),
      down: new Image()
    };

    headImages.right.src = 'imagenes/headRightDefault.png';
    headImages.left.src = 'imagenes/headLeftDefault.png';
    headImages.up.src = 'imagenes/headUpDefault.png';
    headImages.down.src = 'imagenes/headDownDefault.png';

    var tailImage = new Image();
    tailImage.src = 'imagenes/tailRightDefault.png';

    var bodyImage = new Image();
    bodyImage.src = 'imagenes/bodyLeftRightDefault.png';

    // Clase para representar la serpiente
    function Snake() {
      this.segments = [];
      this.direction = 'right';

      // Inicializar la serpiente
      this.init = function() {
        var startX = Math.floor(canvasWidth / (2 * segmentSize)) * segmentSize;
        var startY = Math.floor(canvasHeight / (2 * segmentSize)) * segmentSize;

        // Crear segmentos para la serpiente
        for (var i = 0; i < 5; i++) {
          var segment = {
            x: startX - i * segmentSize,
            y: startY
          };
          this.segments.push(segment);
        }
      };

      // Dibujar la serpiente en el lienzo (canvas)
      this.draw = function() {
        context.clearRect(0, 0, canvasWidth, canvasHeight);

        // Dibujar cada segmento de la serpiente
        for (var i = 0; i < this.segments.length; i++) {
          var segment = this.segments[i];

          // Dibujar la cabeza
          if (i === 0) {
            var headImage = headImages[this.direction];
            context.drawImage(headImage, segment.x, segment.y, segmentSize, segmentSize);
          }
          // Dibujar la cola
          else if (i === this.segments.length - 1) {
            context.drawImage(tailImage, segment.x, segment.y, segmentSize, segmentSize);
          }
          // Dibujar el cuerpo o el giro
          else {
            // Verificar si el segmento anterior y el siguiente tienen una dirección diferente
            if (
              (this.segments[i - 1].x !== this.segments[i + 1].x && this.segments[i - 1].y !== this.segments[i + 1].y) ||
              (this.segments[i - 1].x === this.segments[i].x && this.segments[i + 1].x === this.segments[i].x) ||
              (this.segments[i - 1].y === this.segments[i].y && this.segments[i + 1].y === this.segments[i].y)
            ) {
              // Obtener la dirección del giro
              var direction = getTurnDirection(this.segments[i - 1], segment, this.segments[i + 1]);
              drawTurnImage(segment.x, segment.y, direction);
            } else {
              context.drawImage(bodyImage, segment.x, segment.y, segmentSize, segmentSize);
            }
          }
        }
      };

      // Mover la serpiente en la dirección actual
      this.move = function() {
        var headX = this.segments[0].x;
        var headY = this.segments[0].y;

        // Calcular la posición de la cabeza en la siguiente casilla
        if (this.direction === 'right') {
          headX += segmentSize;
        } else if (this.direction === 'left') {
          headX -= segmentSize;
        } else if (this.direction === 'up') {
          headY -= segmentSize;
        } else if (this.direction === 'down') {
          headY += segmentSize;
        }

        // Crear un nuevo segmento para la cabeza
        var newHead = {
          x: headX,
          y: headY
        };

        // Agregar la nueva cabeza al inicio de la serpiente
        this.segments.unshift(newHead);

        // Eliminar el último segmento (cola) de la serpiente
        this.segments.pop();
      };

      // Cambiar la dirección de la serpiente
      this.changeDirection = function(newDirection) {
        this.direction = newDirection;
      };
    }

    // Crear una instancia de la serpiente
    var snake = new Snake();
    snake.init();

    // Función para manejar el evento de presionar una tecla
    function handleKeyPress(event) {
      var key = event.keyCode;

      // Cambiar la dirección de la serpiente según la tecla presionada
      if (key === 37 && snake.direction !== 'right') {
        snake.changeDirection('left');
      } else if (key === 38 && snake.direction !== 'down') {
        snake.changeDirection('up');
      } else if (key === 39 && snake.direction !== 'left') {
        snake.changeDirection('right');
      } else if (key === 40 && snake.direction !== 'up') {
        snake.changeDirection('down');
      }
    }

    // Agregar el evento de presionar una tecla al documento
    document.addEventListener('keydown', handleKeyPress);

    // Función para animar el juego
    function animate() {
      snake.move();
      snake.draw();

      // Volver a llamar a la función animate después de un tiempo
      setTimeout(animate, 1000 / speed);
    }

    // Iniciar la animación del juego
    animate();

    // Función para determinar la dirección del giro
    function getTurnDirection(prevSegment, currentSegment, nextSegment) {
      if (prevSegment.x === currentSegment.x) {
        if (prevSegment.y < currentSegment.y && nextSegment.x > currentSegment.x) {
          return 'down-right';
        } else if (prevSegment.y > currentSegment.y && nextSegment.x > currentSegment.x) {
          return 'up-right';
        } else if (prevSegment.y > currentSegment.y && nextSegment.x < currentSegment.x) {
          return 'up-left';
        } else if (prevSegment.y < currentSegment.y && nextSegment.x < currentSegment.x) {
          return 'down-left';
        }
      } else if (prevSegment.y === currentSegment.y) {
        if (prevSegment.x < currentSegment.x && nextSegment.y > currentSegment.y) {
          return 'right-down';
        } else if (prevSegment.x > currentSegment.x && nextSegment.y > currentSegment.y) {
          return 'left-down';
        } else if (prevSegment.x > currentSegment.x && nextSegment.y < currentSegment.y) {
          return 'left-up';
        } else if (prevSegment.x < currentSegment.x && nextSegment.y < currentSegment.y) {
          return 'right-up';
        }
      }
    }

    // Función para dibujar la imagen de giro en la posición especificada
    function drawTurnImage(x, y, direction) {
      var turnImage = new Image();
      turnImage.src = 'imagenes/giro_' + direction + '.png';
      context.drawImage(turnImage, x, y, segmentSize, segmentSize);
    }
  </script>
</body>
</html>
