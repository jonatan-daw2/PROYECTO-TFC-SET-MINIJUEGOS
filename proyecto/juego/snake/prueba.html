<!DOCTYPE html>
<html>

<head>
    <title>Juego de la Serpiente</title>
    <style>
        canvas {
            border: 1px solid #000;
        }

        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div id="score">Puntuacion: 0</div>
    <div id="highScore">Puntuacion mas alta: 0</div>

    <script>
        // Configuración del juego
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const gridSize = 20;
        const gridWidth = canvas.width / gridSize;
        const gridHeight = canvas.height / gridSize;

        // Sprites
        const headSprite = new Image();
        //headSprite.src = 'imagenes/headRightDefault.png';
        const bodySprite = new Image();
        //bodySprite.src = "imagen/bodyRightDefauult.png";
        const tailSprite = new Image();
        //tailSprite.src = 'imagenes/tailRightDefault.png';
        const appleSprite = new Image();
        appleSprite.src = 'imagenes/appleDefault.png';


        // Estado del juego
        let snake = [
            { x: 10, y: 10 },
            { x: 9, y: 10 },
        ];
        let direction = "right";
        let fruit = getRandomPosition();
        let score = 0;
        let highScore = 0; // Reiniciar la puntuación máxima a 0
        let gameOver = false;
        let gameStarted = false;

        // Elementos HTML
        const scoreElement = document.getElementById("score");
        const highScoreElement = document.getElementById("highScore");

        // Función principal del juego
        function gameLoop() {
            clearCanvas();
            updateSnake();
            drawSnake();
            drawFruit();
            drawScore();

            if (isGameOver()) {
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem("highScore", highScore);
                }
                gameOver = true;
                showGameOverMessage();
            }

            if (!gameOver) {
                setTimeout(gameLoop, 100);
            }
        }

        // Limpia el canvas
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Actualiza la posición de la serpiente
        function updateSnake() {
            const head = { x: snake[0].x, y: snake[0].y };

            // Actualiza la posición de la cabeza de la serpiente en base a la dirección
            if (direction === "up") head.y--;
            if (direction === "down") head.y++;
            if (direction === "left") head.x--;
            if (direction === "right") head.x++;

            // Girar la cabeza hacia la dirección deseada
            if (snake.length > 1) {
                const nextSegment = snake[1];
                if (head.x < nextSegment.x) {
                    headSprite.src = "imagenes/headLeftDefault.png";
                    bodySprite.src = "imagenes/bodyLeftRightDefault.png";
                    tailSprite.src = 'imagenes/tailLeftDefault.png';
                } else if (head.x > nextSegment.x) {
                    headSprite.src = "imagenes/headRightDefault.png";
                    bodySprite.src = "imagenes/bodyLeftRightDefault.png";
                    tailSprite.src = 'imagenes/tailRightDefault.png';
                } else if (head.y < nextSegment.y) {
                    headSprite.src = "imagenes/headUpDefault.png";
                    bodySprite.src = "imagenes/bodyUpDownDefault.png";
                    tailSprite.src = 'imagenes/tailUpDefault.png';
                } else if (head.y > nextSegment.y) {
                    headSprite.src = "imagenes/headDownDefault.png";
                    bodySprite.src = "imagenes/bodyUpDownDefault.png";
                    tailSprite.src = 'imagenes/tailDownDefault.png';
                }
            }

            snake.unshift(head); // Agrega la nueva cabeza al inicio de la serpiente

            // Verifica si la serpiente ha comido una fruta
            if (head.x === fruit.x && head.y === fruit.y) {
                score++;
                fruit = getRandomPosition(); // Genera una nueva posición para la fruta
            } else {
                snake.pop(); // Elimina la última parte de la serpiente si no ha comido una fruta
            }
        }

        function drawSnakeHead() {
    const head = snake[0];
    const headX = head.x * gridSize;
    const headY = head.y * gridSize;
    
    // Draw the head sprite based on the current direction
    if (direction === "up") {
        headSprite.src = "imagenes/headUpDefault.png";
    } else if (direction === "down") {
        headSprite.src = "imagenes/headDownDefault.png";
    } else if (direction === "left") {
        headSprite.src = "imagenes/headLeftDefault.png";
    } else if (direction === "right") {
        headSprite.src = "imagenes/headRightDefault.png";
    }
    
    ctx.drawImage(headSprite, headX, headY, gridSize, gridSize);
}


        // Dibuja la serpiente en el canvas
        //   function drawSnake() {
        //     snake.forEach((segment, index) => {
        //       if (index === 0) {
        //         // Dibuja la cabeza de la serpiente utilizando el sprite de cabeza
        //         ctx.drawImage(
        //           headSprite,
        //           segment.x * gridSize,
        //           segment.y * gridSize,
        //           gridSize,
        //           gridSize
        //         );
        //       } else {
        //         // Dibuja el cuerpo de la serpiente utilizando el sprite de cuerpo
        //         ctx.drawImage(
        //           bodySprite,
        //           segment.x * gridSize,
        //           segment.y * gridSize,
        //           gridSize,
        //           gridSize
        //         );
        //       }
        //     });
        //   }

        function drawSnake() {
            snake.forEach((segment, index) => {
                if (index === 0) {
                    drawSnakeHead();
                } else if (index === snake.length - 1) {
                    const tailX = segment.x * gridSize;
                    const tailY = segment.y * gridSize;
                    ctx.drawImage(tailSprite, tailX, tailY, gridSize, gridSize);
                } else {
                    const segmentX = segment.x * gridSize;
                    const segmentY = segment.y * gridSize;
                    ctx.drawImage(bodySprite, segmentX, segmentY, gridSize, gridSize);
                }
            });
        }
        // Dibuja la fruta en el canvas
        function drawFruit() {
            const fruitX = fruit.x * gridSize;
            const fruitY = fruit.y * gridSize;
            ctx.drawImage(appleSprite, fruitX, fruitY, gridSize, gridSize);
        }


        // Dibuja la puntuación en la pantalla
        function drawScore() {
            scoreElement.textContent = "Puntuacion: " + score;
            highScoreElement.textContent = "Puntuacion mas alta: " + highScore;
        }

        // Verifica si el juego ha terminado
        function isGameOver() {
            const head = snake[0];

            // Verifica si la serpiente choca con los bordes del tablero
            if (
                head.x < 0 ||
                head.x >= gridWidth ||
                head.y < 0 ||
                head.y >= gridHeight
            ) {
                return true;
            }

            // Verifica si la serpiente choca consigo misma
            for (let i = 1; i < snake.length; i++) {
                if (snake[i].x === head.x && snake[i].y === head.y) {
                    return true;
                }
            }

            return false;
        }

        // Genera una posición aleatoria para la fruta
        function getRandomPosition() {
            return {
                x: Math.floor(Math.random() * gridWidth),
                y: Math.floor(Math.random() * gridHeight),
            };
        }

        // Muestra el mensaje de "GAME OVER!!" en el centro del canvas
        function showGameOverMessage() {
            ctx.fillStyle = "#000000"; // Color negro
            ctx.font = "30px Arial";
            ctx.textAlign = "center";
            ctx.fillText("GAME OVER!!", canvas.width / 2, canvas.height / 2);
        }

        // Muestra el mensaje de inicio en el centro del canvas
        function showGameInitMessage() {
            ctx.fillStyle = "#000000"; // Color negro
            ctx.font = "24px Arial";
            ctx.textAlign = "center";
            ctx.fillText(
                "Pulsa la tecla Espacio para empezar",
                canvas.width / 2,
                canvas.height / 2
            );
        }

        // Reinicia el juego
        function resetGame() {
            snake = [
                { x: 10, y: 10 },
                { x: 9, y: 10 },
            ];
            direction = "right";
            fruit = getRandomPosition();
            score = 0;
            gameOver = false;
        }

        // Control de la dirección de la serpiente mediante las teclas de flecha
        document.addEventListener("keydown", (event) => {
            if (event.key === "ArrowUp" && direction !== "down") {
                direction = "up";
            } else if (event.key === "ArrowDown" && direction !== "up") {
                direction = "down";
            } else if (event.key === "ArrowLeft" && direction !== "right") {
                direction = "left";
            } else if (event.key === "ArrowRight" && direction !== "left") {
                direction = "right";
            } else if (event.key === " ") {
                // Reinicia el juego al presionar la tecla de espacio
                if (gameOver) {
                    resetGame();
                    gameStarted = true;
                    gameLoop();
                } else if (!gameStarted) {
                    gameStarted = true;
                    gameLoop();
                }
            }
        });

        // Reinicia la puntuación máxima a 0 al cargar la página
        window.addEventListener("load", () => {
            highScore = 0;
            localStorage.setItem("highScore", highScore);
        });

        // Inicializa el juego y muestra el mensaje de inicio
        showGameInitMessage();
    </script>
</body>

</html>